# üìÖ –ë–æ—Ç –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
![Python ver](https://img.shields.io/badge/pyhon-3.10-orange)
![aiogram](https://img.shields.io/badge/aiogram-3.13.1-blue)
![postgres](https://img.shields.io/badge/postgre-16-42a4ff)
![arq](https://img.shields.io/badge/arq-0.26.1-yellow)


## üí°–û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

1. `–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø–æ–¥–µ–ª–µ–Ω—ã` –Ω–∞ `–≥—Ä—É–ø–ø—ã`

2. –°–≤–æ–µ–≤—Ä–µ–º–µ–Ω–Ω–æ `–æ–¥–∏–Ω –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π` —Å–≤–æ–µ–π –≥—Ä—É–ø–ø—ã `–ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ` –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π –¥–µ–Ω—å
3. `–ë–æ—Ç –ø—Ä–∏—Å—ã–ª–∞–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ` –≤ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è `–≤—Å–µ–º –≥—Ä—É–ø–ø–∞–º` –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø—Ä–∏—Å–ª–∞–≤—à–∏—Ö —Ñ–æ—Ç–æ/—Ç–µ–∫—Å—Ç —Å–≤–æ–∏—Ö –∑–∞–Ω—è—Ç–∏–π. `–ò–ª–∏ –Ω–∞–ø–æ–º–∏–Ω–∞–µ—Ç –æ–± –µ–≥–æ –æ—Ç—Å—É—Ç—Å–≤–∏–∏`, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–¥–µ–ª–∞–ª–∏ —ç—Ç–æ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ 


## üë• –î–µ–ª–µ–Ω–∏–µ –ø–æ –≥—Ä—É–ø–ø–∞–º

> core > middlewares > command_middleware.py

### –ó–∞–¥–∞—á–∏üìå

1. –ü–æ —É—Å–ª–æ–≤–∏—é, –º—ã –¥–µ–ª–∞–µ–º —Ä–∞—Å—Å—ã–ª–∫—É –ø–æ –≥—Ä—É–ø–ø–∞–º. –≠—Ç–æ –∑–Ω–∞—á–∏—Ç, –º—ã –Ω–µ –º–æ–∂–µ–º –ø–æ–∑–≤–æ–ª–∏—Ç—å –Ω–µ–∏–Ω–¥–µ—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –±–æ—Ç–æ–º 
    
    * `–°—Ç–æ–∏—Ç –∑–∞–¥–∞—á–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –ø–µ—Ä–µ–¥ –ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º`

2. –ú—ã –º–æ–≥–ª–∏ –±—ã –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å "–ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å" –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–∞–ø—Ä–µ—Ç–∏–≤ –º–µ–Ω—è—Ç—å –≥—Ä—É–ø–ø—É, –Ω–æ –ª—é–±–æ–π —á–µ–ª–æ–≤–µ–∫ –º–æ–∂–µ—Ç –æ—à–∏–±–∏—Ç—å—Å—è... –ò–ª–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ —Å–ø—Ä–æ–≤–æ—Ü–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—É–¥–æ–±–Ω—É—é —Å–∏—Ç—É–∞—Ü–∏—é, –≤—ã–ª–æ–∂–∏–≤ —á—Ç–æ —É–≥–æ–¥–Ω–æ –≤–º–µ—Å—Ç–æ –Ω—É–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ :-)

    * `–ù–µ–æ–±—Ö–æ–¥–∏–º 100% —Å–ø–æ—Å–æ–± –≤—ã—è–≤–ª–µ–Ω–∏—è –∞–≤—Ç–æ—Ä–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è`

### –†–µ—à–µ–Ω–∏–µüéØ

1. ‚ùå–ú–æ–∂–Ω–æ –ø–æ—Å—Ç–∞–≤–∏—Ç—å `Middleware` , –∫–æ—Ç–æ—Ä—ã–π –±—É–¥–µ—Ç –Ω–∞ –∫–∞–∂–¥–æ–º –∞–ø–¥–µ–π—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–ª–µ `users.group` . –û–¥–Ω–∞–∫–æ —ç—Ç–æ `–ø–∞–≥—É–±–Ω–æ` —Å–∫–∞–∂–µ—Ç—Å—è `–∏–∑-–∑–∞ –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –±–¥`. ..
* ‚úÖ–ü—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–∞—Ç—å –∑–∞–±—Ä–∞—Å—ã–≤–∞—Ç—å –±–æ—Ç–∞ –∞–ø–¥–µ–π—Ç–∞–º–∏, –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã, —Ç–∞–∫ –∫–∞–∫ –ø–æ—Å–ª–µ –Ω–µ—É–¥–∞—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ –Ω–∏—Ö –¥–∞–ª—å–Ω–µ–π—à–µ–µ –æ–±—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –º—ã —Å—É–∂–∞–µ–º –∫—Ä—É–≥ –¥–µ–π—Å—Ç–≤–∏—è `Middleware`, —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—è –∏—Ö —Ç–æ–ª—å–∫–æ –Ω–∞ `message` –∏ –∑–∞–¥–∞–≤–∞—è —É—Å–ª–æ–≤–∏–µ:
```py
if text.startswith('/') and text != '/start' and text != '/help':
    async with self.cursor.acquire():
        query = 'SELECT "group" FROM users WHERE tg_id = $1'
        res: List[Record] = await self.cursor.fetch(query, event.chat.id)

    if not res[0][0]:
        # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –≤—ã–±—Ä–∞—Ç—å –≥—Ä—É–ø–ø—É
        # > core > timetable > groups_actions.py
    else:
        # –î–∞—ë–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –∑–µ–ª—ë–Ω—ã–π —Å–≤–µ—Ç
```
2. ‚úÖ–ó–¥–µ—Å—å –ú—ã –ø—Ä–æ—Å—Ç–æ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Ñ–∏–∫—Å–∏—Ä—É–µ–º –≤ —Ç–∞–±–ª–∏—Ü–µ –ê–≤—Ç–æ—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ tg_id –∏ –ø—Ä–∏–∫—Ä–µ–ø–ª—è–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –≥–∏–ø–µ—Ä-—Å—Å—ã–ª–∫–æ–π –Ω–∞ –Ω–µ–≥–æ

    ![alt text](https://sun9-69.userapi.com/impg/ECk2RcTODh4IWNyLlHPAlBAybOfARqEMYQkK7A/DTL8l4Iqrek.jpg?size=396x594&quality=95&sign=98b4a07c8b49e9a4b247952f8ad3ca23&type=album)


## –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ üìÖ

> core > timetable > modified

> core > timetable > standard

### üìÉ–° –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ & üìú–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ

–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
1. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ - `/ttable_show`
2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ - `/ttable_add`
3. –ò–∑–º–µ–Ω–µ–Ω–∏–µ - `/ttable_update`

* `–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ`

    ![Congratulations](https://sun9-73.userapi.com/impg/oo9-2ZHeLhdSileY1tbywFVpbbFHBBaVKCc77Q/XiFkzM8P5_s.jpg?size=490x385&quality=95&sign=dfcd22d971c4b5718f9fbbc44d98f976&type=album)

* `–î–æ–±–∞–≤–ª–µ–Ω–∏–µ`
    * –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Çüìù
    * –¢–æ–ª—å–∫–æ —Ñ–æ—Ç–æüì∑
    * –¢–µ–∫—Å—Çüìù + –§–æ—Ç–æüì∑
    * ¬´–ü–æ –æ—Å–Ω–æ–≤–Ω–æ–º—É¬ª

* `–ò–∑–º–µ–Ω–µ–Ω–∏–µ`
    * –û—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç ¬´–î–æ–±–∞–≤–ª–µ–Ω–∏–µ¬ª –æ–±—ä—è–≤–ª–µ–Ω–∏–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π-—Ñ–ª–∞–≥–∞ üö© –≤ FSMContext

#### –°–æ—Ö—Ä–∞–Ω—è—Ç—å —Ñ–æ—Ç–æ –±—ã–ª–æ –ø—Ä–∏–Ω—è—Ç–æ –ª–æ–∫–∞–ª—å–Ω–æ, –≤ —Å–∞–º –ø—Ä–æ–µ–∫—Ç –≤ —Ñ–æ—Ä–º–∞—Ç–∞—Ö

* üìÉ –î–ª—è –∏–∑–º–µ–Ω—ë–Ω–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è "dd-MM-YYYY_–ì–†–£–ü–ü–ê"
    > images > daily > 2025-01-24_23–ò1.jpg
* üìú –î–ª—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è "–ì–†–£–ü–ü–ê.jpg"
    > images > standard > 23–ò1.jpg

## üì§–†–∞—Å—Å—ã–ª–∫–∞ & –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µüì®

> core > scheduler

`Arq` –≤ –∑–∞–¥–∞–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –≤—Ä–µ–º–µ–Ω–∏ `–≤—ã–ø–æ–ª–Ω—è–µ—Ç` –£—Ç—Ä–µ–Ω–Ω—é—é –†–∞—Å—Å—ã–ª–∫—É –∏ –í—á–µ—Ä–Ω–µ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ - `morning_sent()` –∏ `ttable_reminder()` , –°–∏–≥–Ω–∞—Ç—É—Ä–∞ –∫–æ—Ç–æ—Ä—ã—Ö –∑–∞–≤—è–∑–∞–Ω–∞ –≤ –∫–ª–∞—Å—Å–µ `SentList` 

#### *–†–∞–∑–ª–∏—á–∏—è –º–µ—Ç–æ–¥–æ–≤ —Ç–æ–ª—å–∫–æ –≤ –∞–ª–≥–æ—Ä–∏—Ç–º–µ –ø–æ–¥–±–æ—Ä–∫–∏ tg_id –∫ —Ä–∞—Å—Å—ã–ª–∫–µ*


* > arq_scheduler.py > morning_sent()

    1. –û—á–∏—Å—Ç–∫–∞ –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    2. –ü–æ–∏—Å–∫ –ì—Ä—É–ø–ø –≤ `tTable`, –≥–¥–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è == —Å–µ–≥–æ–¥–Ω—è
    3. –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è —Å–ø–∏—Å–∫–∞ –∫–æ—Ä—Ç–µ–∂–µ–π, –≤ –∫–æ—Ç–æ—Ä–æ–º: 1 - –≥—Ä—É–ø–ø–∞, 2 - –Ω–∞–ª–∏—á–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è(T/F)
    4. –í—ã–±–∏—Ä–∞–µ–º –≤—Å–µ tg_id –∏–∑ `mailing`
    5. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ "–•–æ—Ä–æ—à–∏–º" –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ "–ü–ª–æ—Ö–∏–º"

* > arq_scheduler.py > ttable_reminder()
    
    1. –û—á–∏—Å—Ç–∫–∞ –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
    2. –í—ã—á–∏—Å–ª—è–µ–º –≥—Ä—É–ø–ø—ã, –Ω–µ –æ—Ç–ø—Ä–∞–≤–∏–≤—à–∏–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
    3. –ü–æ–ª—É—á–∞–µ–º `tg_id` "–ü–ª–æ—Ö–∏—Ö" –≥—Ä—É–ø–ø
    4. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è

## üíæ –ë–î

#### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã 4 —Ç–∞–±–ª–∏—Ü—ã

1. –¢–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π `users`üë•
```sql
CREATE TABLE IF NOT EXISTS public.users
(
    id bigint NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    tg_id bigint NOT NULL,
    name character varying(65) COLLATE pg_catalog."default",
    "group" character varying(10) COLLATE pg_catalog."default",
    status text COLLATE pg_catalog."default" DEFAULT 'member'::text,
    
    CONSTRAINT users_pkey PRIMARY KEY (id),
    CONSTRAINT users_tg_id_key UNIQUE (tg_id)
)
```
#
2. –¢–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∫–∞–∂–¥–æ–π –≥—Ä—É–ø–ø—ã `tTable`üìÖ
```sql
CREATE TABLE IF NOT EXISTS public."tTable"
(
    id bigint NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    lessons text COLLATE pg_catalog."default" NOT NULL,
    ttable_photo character varying(60) COLLATE pg_catalog."default",
    add_time date DEFAULT now(),
    day_sent date NOT NULL,
    "group" character varying(10) COLLATE pg_catalog."default" NOT NULL,
    addinger bigint NOT NULL,
    CONSTRAINT "tTable_pkey" PRIMARY KEY (id),
    CONSTRAINT "tTable_addinger_fkey" FOREIGN KEY (addinger)
        REFERENCES public.users (tg_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID
)
```
#
3. –ü–ª–∞–≤–∞—é—â–∞—èüåÄ —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ `mailing`üì®
```sql
CREATE TABLE IF NOT EXISTS public.mailing
(
    id bigint NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 9223372036854775807 CACHE 1 ),
    tg_id bigint,
    status text COLLATE pg_catalog."default" DEFAULT 'member'::text,
    "group" character varying(10) COLLATE pg_catalog."default",
    CONSTRAINT mailing_pkey PRIMARY KEY (id),
    CONSTRAINT mailing_tg_id_key UNIQUE (tg_id)
)
```
#
4. –°–∞–º–∞—è –º–∞–ª–µ–Ω—å–∫–∞—è —Ç–∞–±–ª–∏—Ü–∞ `default_ttable`üå±
```sql
CREATE TABLE IF NOT EXISTS public.default_ttable
(
    id integer NOT NULL GENERATED ALWAYS AS IDENTITY ( INCREMENT 1 START 1 MINVALUE 1 MAXVALUE 2147483647 CACHE 1 ),
    ttable_photo character varying(40) COLLATE pg_catalog."default" NOT NULL,
    "group" character varying(10) COLLATE pg_catalog."default" NOT NULL,
    addinger bigint NOT NULL,
    CONSTRAINT default_ttable_pkey PRIMARY KEY (id),
    CONSTRAINT default_ttable_group_key UNIQUE ("group")
        CONSTRAINT "default_ttable_addinger_fkey" FOREIGN KEY (addinger)
        REFERENCES public.users (tg_id) MATCH SIMPLE
        ON UPDATE NO ACTION
        ON DELETE NO ACTION
        NOT VALID
)
```

# –°–ø–∞—Å–∏–±–æ –ó–∞ –ü—Ä–æ—á—Ç–µ–Ω–∏–µ‚ú®üòá